<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="ja"><meta name=color-scheme content="light dark"><meta name=author content="takeya0x86"><meta name=description content="
  Playwrightとは
  
    
  

2020年の1月末頃から話題になっているNode.js向けのブラウザ自動化ライブラリです。GithubのMicrosoftリポジトリで公開されています。
https://github.com/Microsoft/playwright
READMEの記述1によると、GoogleでPuppeteerを開発していたチームがその後移って来て開発を開始したそうです。
Puppeteerとの差異としてよりtesting-friendlyなAPIを目指すこと、ChromeだけでなくFirefox、Webkitにも単一のAPIで対応すること、そのために互換性を持たない変更が必要になったためPuppeteerからコードベースを作り直しているたことなどが表明されています。
この記事ではPlaywrightをさわってみた所感をPuppeteerやWebDriverと比較をしながら書いていこうと思います。
Playwrightのバージョンは執筆時で最新のv0.10.0、Puppeteerは同じく最新のv2.1.0です。"><meta name=keywords content="blog,developer,personal,Selenium,Appium"><meta name=twitter:card content="summary"><meta name=twitter:title content="Playwrightファーストインプレッション"><meta name=twitter:description content="
  Playwrightとは
  
    
  

2020年の1月末頃から話題になっているNode.js向けのブラウザ自動化ライブラリです。GithubのMicrosoftリポジトリで公開されています。
https://github.com/Microsoft/playwright
READMEの記述1によると、GoogleでPuppeteerを開発していたチームがその後移って来て開発を開始したそうです。
Puppeteerとの差異としてよりtesting-friendlyなAPIを目指すこと、ChromeだけでなくFirefox、Webkitにも単一のAPIで対応すること、そのために互換性を持たない変更が必要になったためPuppeteerからコードベースを作り直しているたことなどが表明されています。
この記事ではPlaywrightをさわってみた所感をPuppeteerやWebDriverと比較をしながら書いていこうと思います。
Playwrightのバージョンは執筆時で最新のv0.10.0、Puppeteerは同じく最新のv2.1.0です。"><meta property="og:title" content="Playwrightファーストインプレッション"><meta property="og:description" content="
  Playwrightとは
  
    
  

2020年の1月末頃から話題になっているNode.js向けのブラウザ自動化ライブラリです。GithubのMicrosoftリポジトリで公開されています。
https://github.com/Microsoft/playwright
READMEの記述1によると、GoogleでPuppeteerを開発していたチームがその後移って来て開発を開始したそうです。
Puppeteerとの差異としてよりtesting-friendlyなAPIを目指すこと、ChromeだけでなくFirefox、Webkitにも単一のAPIで対応すること、そのために互換性を持たない変更が必要になったためPuppeteerからコードベースを作り直しているたことなどが表明されています。
この記事ではPlaywrightをさわってみた所感をPuppeteerやWebDriverと比較をしながら書いていこうと思います。
Playwrightのバージョンは執筆時で最新のv0.10.0、Puppeteerは同じく最新のv2.1.0です。"><meta property="og:type" content="article"><meta property="og:url" content="https://takeya0x86.github.io/2020/02/07/playwright-first-impression/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-02-07T09:00:00+09:00"><meta property="article:modified_time" content="2020-02-07T09:00:00+09:00"><title>Playwrightファーストインプレッション · takeya's blog</title><link rel=canonical href=https://takeya0x86.github.io/2020/02/07/playwright-first-impression/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.1.7" as=font type=font/woff2 integrity="sha256-hEIt6X6xzye8ubyk8/uxjz68cRZHsJxoKS9fQ8idUGQ=" crossorigin><link rel=stylesheet href=/css/coder.min.ec198d25949ddd79a670b1ead43ca88e0bc2c1343266d0df0a9eeb7f3f207777.css integrity="sha256-7BmNJZSd3XmmcLHq1DyojgvCwTQyZtDfCp7rfz8gd3c=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.89c82b6022b96f77aeb521b240daec4f87ea029d84d1c78b8acd0735b91b3c92.css integrity="sha256-icgrYCK5b3eutSGyQNrsT4fqAp2E0ceLis0HNbkbPJI=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><meta name=generator content="Hugo 0.81.0"></head><body class=colorscheme-auto><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>takeya's blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://takeya0x86.github.io/2020/02/07/playwright-first-impression/>Playwrightファーストインプレッション</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i><time datetime=2020-02-07T09:00:00+09:00>2020年2月7日</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>7分で読めます</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i><a href=/tags/selenium/>Selenium</a>
<span class=separator>•</span>
<a href=/tags/testing/>testing</a>
<span class=separator>•</span>
<a href=/tags/automation/>automation</a>
<span class=separator>•</span>
<a href=/tags/puppeteer/>Puppeteer</a>
<span class=separator>•</span>
<a href=/tags/playwright/>Playwright</a></div></div></header><div><h2 id=playwrightとは>Playwrightとは
<a class=heading-link href=#playwright%e3%81%a8%e3%81%af><i class="fa fa-link" aria-hidden=true></i></a></h2><p>2020年の1月末頃から話題になっているNode.js向けのブラウザ自動化ライブラリです。GithubのMicrosoftリポジトリで公開されています。</p><p><a href=https://github.com/Microsoft/playwright>https://github.com/Microsoft/playwright</a></p><p>READMEの記述<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>によると、GoogleでPuppeteerを開発していたチームがその後移って来て開発を開始したそうです。
Puppeteerとの差異としてよりtesting-friendlyなAPIを目指すこと、ChromeだけでなくFirefox、Webkitにも単一のAPIで対応すること、そのために互換性を持たない変更が必要になったためPuppeteerからコードベースを作り直しているたことなどが表明されています。</p><p>この記事ではPlaywrightをさわってみた所感をPuppeteerやWebDriverと比較をしながら書いていこうと思います。</p><p>Playwrightのバージョンは執筆時で最新の<code>v0.10.0</code>、Puppeteerは同じく最新の<code>v2.1.0</code>です。</p><h2 id=puppeteerからの変更点>Puppeteerからの変更点
<a class=heading-link href=#puppeteer%e3%81%8b%e3%82%89%e3%81%ae%e5%a4%89%e6%9b%b4%e7%82%b9><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Puppeteerとの比較は同じテストシナリオを実装する際のAPI（メソッド）の違いを中心に見ていきます。</p><h3 id=今回のシナリオ>今回のシナリオ
<a class=heading-link href=#%e4%bb%8a%e5%9b%9e%e3%81%ae%e3%82%b7%e3%83%8a%e3%83%aa%e3%82%aa><i class="fa fa-link" aria-hidden=true></i></a></h3><p>サンプルとして使用するテストシナリオです。PlaywrightのREADMEに記載されているサンプルとほぼ同様の内容にしています。</p><ol><li>ブラウザを起動してGoogle Pixel 2と同じ画面解像度・UserAgentに設定する</li><li>現在地の位置情報を新宿駅の緯度経度に設定する</li><li>Googleマップを開く</li><li>「現在地」のボタンを押す</li><li>Ajax通信の完了を待機する</li><li>スクリーンショットを取得する</li><li>ブラウザを閉じる</li></ol><h3 id=今回のサンプルコード>今回のサンプルコード
<a class=heading-link href=#%e4%bb%8a%e5%9b%9e%e3%81%ae%e3%82%b5%e3%83%b3%e3%83%97%e3%83%ab%e3%82%b3%e3%83%bc%e3%83%89><i class="fa fa-link" aria-hidden=true></i></a></h3><p>まず、今回のシナリオをPuppeteerを使って書くと以下のようなコードになります。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>puppeteer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;puppeteer&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pixel2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>puppeteer</span>.<span style=color:#a6e22e>devices</span>[<span style=color:#e6db74>&#39;Pixel 2&#39;</span>];

(<span style=color:#66d9ef>async</span> () =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>browser</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>puppeteer</span>.<span style=color:#a6e22e>launch</span>();
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>defaultBrowserContext</span>().<span style=color:#a6e22e>overridePermissions</span>(<span style=color:#e6db74>&#39;https://www.google.co.jp&#39;</span>, [<span style=color:#e6db74>&#39;geolocation&#39;</span>]);
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>newPage</span>();
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>setViewport</span>(<span style=color:#a6e22e>pixel2</span>.<span style=color:#a6e22e>viewport</span>);
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>setUserAgent</span>(<span style=color:#a6e22e>pixel2</span>.<span style=color:#a6e22e>userAgent</span>);
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>setGeolocation</span>({ <span style=color:#a6e22e>latitude</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>35.690833</span>, <span style=color:#a6e22e>longitude</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>139.700278</span> });

  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#66d9ef>goto</span>(<span style=color:#e6db74>&#39;https://www.google.co.jp/maps&#39;</span>);
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>waitForXPath</span>(<span style=color:#e6db74>&#39;//*[text()=&#34;現在地&#34;]&#39;</span>, { <span style=color:#a6e22e>visible</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> });
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handle</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>$x</span>(<span style=color:#e6db74>&#39;//*[text()=&#34;現在地&#34;]&#39;</span>);
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>handle</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>click</span>();
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>waitForRequest</span>(<span style=color:#a6e22e>req</span> =&gt; <span style=color:#f92672>/</span>.<span style=color:#f92672>*</span><span style=color:#a6e22e>pwa</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>/</span><span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>js</span>.<span style=color:#f92672>*</span><span style=color:#960050;background-color:#1e0010>/.test(req.url()));</span>
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>screenshot</span>({ <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;shinjuku-android-1.png&#39;</span> });
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>close</span>();
})();
</code></pre></div><p>続いて同じシナリオをPlaywrightで書くと以下のようになります。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>playwright</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;playwright&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pixel2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>playwright</span>.<span style=color:#a6e22e>devices</span>[<span style=color:#e6db74>&#39;Pixel 2&#39;</span>];

(<span style=color:#66d9ef>async</span> () =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>browser</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>playwright</span>.<span style=color:#a6e22e>chromium</span>.<span style=color:#a6e22e>launch</span>();
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>context</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>newContext</span>({
    <span style=color:#a6e22e>viewport</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pixel2</span>.<span style=color:#a6e22e>viewport</span>,
    <span style=color:#a6e22e>userAgent</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pixel2</span>.<span style=color:#a6e22e>userAgent</span>,
    <span style=color:#a6e22e>geolocation</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>latitude</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>35.690833</span>, <span style=color:#a6e22e>longitude</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>139.700278</span> },
    <span style=color:#a6e22e>permissions</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#39;https://www.google.co.jp&#39;</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;geolocation&#39;</span>] }
  });

  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>newPage</span>(<span style=color:#e6db74>&#39;https://www.google.co.jp/maps&#39;</span>);
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>click</span>(<span style=color:#e6db74>&#39;text=&#34;現在地&#34;&#39;</span>);
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>waitForRequest</span>(<span style=color:#e6db74>/.*pwa\/net.js.*/</span>);
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>screenshot</span>({ <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;shinjuku-android-2.png&#39;</span> });
  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>close</span>();
})();
</code></pre></div><p>以下、順に見ていきます。</p><h3 id=browsercontextクラス><code>BrowserContext</code>クラス
<a class=heading-link href=#browsercontext%e3%82%af%e3%83%a9%e3%82%b9><i class="fa fa-link" aria-hidden=true></i></a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// Puppeteer
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pixel2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>puppeteer</span>.<span style=color:#a6e22e>devices</span>[<span style=color:#e6db74>&#39;Pixel 2&#39;</span>];
<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>defaultBrowserContext</span>().<span style=color:#a6e22e>overridePermissions</span>(<span style=color:#e6db74>&#39;https://www.google.co.jp&#39;</span>, [<span style=color:#e6db74>&#39;geolocation&#39;</span>]);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>newPage</span>();
<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>setViewport</span>(<span style=color:#a6e22e>pixel2</span>.<span style=color:#a6e22e>viewport</span>);
<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>setUserAgent</span>(<span style=color:#a6e22e>pixel2</span>.<span style=color:#a6e22e>userAgent</span>);
<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>setGeolocation</span>({ <span style=color:#a6e22e>latitude</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>35.690833</span>, <span style=color:#a6e22e>longitude</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>139.700278</span> });

<span style=color:#75715e>// Playwright
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pixel2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>playwright</span>.<span style=color:#a6e22e>devices</span>[<span style=color:#e6db74>&#39;Pixel 2&#39;</span>];
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>context</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>newContext</span>({
  <span style=color:#a6e22e>viewport</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pixel2</span>.<span style=color:#a6e22e>viewport</span>,
  <span style=color:#a6e22e>userAgent</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pixel2</span>.<span style=color:#a6e22e>userAgent</span>,
  <span style=color:#a6e22e>geolocation</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>latitude</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>35.690833</span>, <span style=color:#a6e22e>longitude</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>139.700278</span> },
  <span style=color:#a6e22e>permissions</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#39;https://www.google.co.jp&#39;</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;geolocation&#39;</span>] }
});
</code></pre></div><p><code>devices</code>は主要なモバイル端末の解像度やUserAgentの情報が入っているオブジェクトです。これは双方にあります。<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>
大きく違うのはその後のブラウザの初期設定をするところです。設定ができる項目は同じですが、散らばっていた設定がPlaywrightでは<code>newContext</code>メソッドに集約されているのがわかると思います。
Playwrightでは<code>BrowserContext</code>クラスが拡張され、エミュレーションなどの設定が<code>Page</code>クラスよりも一つ下のレイヤでできるようになっています。Playwrightはこの<code>BrowserContext</code>クラスをブラウザ操作の基点として使うようです。</p><h3 id=selector-enginesとdefault-wait>Selector enginesとDefault wait
<a class=heading-link href=#selector-engines%e3%81%a8default-wait><i class="fa fa-link" aria-hidden=true></i></a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// Puppeteer
</span><span style=color:#75715e></span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#66d9ef>goto</span>(<span style=color:#e6db74>&#39;https://www.google.co.jp/maps&#39;</span>);
<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>waitForXPath</span>(<span style=color:#e6db74>&#39;//*[text()=&#34;現在地&#34;]&#39;</span>, { <span style=color:#a6e22e>visible</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> });
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handle</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>$x</span>(<span style=color:#e6db74>&#39;//*[text()=&#34;現在地&#34;]&#39;</span>);
<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>handle</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>click</span>();

<span style=color:#75715e>// Playwright
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>newPage</span>(<span style=color:#e6db74>&#39;https://www.google.co.jp/maps&#39;</span>);
<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>click</span>(<span style=color:#e6db74>&#39;text=&#34;現在地&#34;&#39;</span>);
</code></pre></div><p>PlaywrightではCSS SelectorとXPathに加えて、書式の違う複数のセレクタが使用可能になっており、現在利用可能なセレクタは<a href=https://github.com/microsoft/playwright/blob/v0.10.0/docs/selectors.md>Selector engines</a>にリストされています。
サンプルではテキストノードの値とマッチさせる<code>text</code>セレクタを使用しています。 PuppeteerではCSS SelectorとXPathで別のメソッド（<code>$</code>と<code>$x</code>）となっており、<code>click</code>メソッドではCSS Selectorのみ使用可能でした。Playwrightでは<code>selector name=selector body</code>の書式で複数のセレクタに対応するようになっています。
また、Playwrightでは<code>click</code>メソッドがデフォルトで対象要素が<code>visible</code>になるまで待機するようになっています。<code>waitForXPath</code>が無くても相当する機能が<code>click</code>に含まれているという感じです。</p><h3 id=waitforrequest><code>waitForRequest</code>
<a class=heading-link href=#waitforrequest><i class="fa fa-link" aria-hidden=true></i></a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// Puppeteer
</span><span style=color:#75715e></span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>waitForRequest</span>(<span style=color:#a6e22e>req</span> =&gt; <span style=color:#f92672>/</span>.<span style=color:#f92672>*</span><span style=color:#a6e22e>pwa</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>/</span><span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>js</span>.<span style=color:#f92672>*</span><span style=color:#960050;background-color:#1e0010>/.test(req.url()));</span>

<span style=color:#75715e>// Playwright
</span><span style=color:#75715e></span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>waitForRequest</span>(<span style=color:#e6db74>/.*pwa\/net.js.*/</span>);
</code></pre></div><p><code>waitForRequest</code>は指定したURLのリクエストが完了するまで待機するメソッドです。このメソッドは双方にありますが、小さな変更点としてPlaywrightではURLの正規表現を直接引数に取れるように変更されています。
このメソッドの存在は後述のWebDriverとの大きな違いとなります。</p><h2 id=selenium-webdriverとの比較>Selenium WebDriverとの比較
<a class=heading-link href=#selenium-webdriver%e3%81%a8%e3%81%ae%e6%af%94%e8%bc%83><i class="fa fa-link" aria-hidden=true></i></a></h2><p>ここからはWebDriverとの比較を行います。</p><h3 id=サポートされているwebブラウザの機能>サポートされているWebブラウザの機能
<a class=heading-link href=#%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88%e3%81%95%e3%82%8c%e3%81%a6%e3%81%84%e3%82%8bweb%e3%83%96%e3%83%a9%e3%82%a6%e3%82%b6%e3%81%ae%e6%a9%9f%e8%83%bd><i class="fa fa-link" aria-hidden=true></i></a></h3><p>前述のサンプルコードの通り、Playwrightはgeolocationの設定やモバイル端末のエミュレーション機能などが実装されており、かつこれをブラウザの種類を問わず同じAPIで提供することを目標にしています。
WebDriverはブラウザの基本操作を以外でAPIが定義されているのはCookieの読み書き<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>くらいです。モバイル端末のエミュレーションは存在していますがChromeDriverの独自の機能となっており統一されたAPIは提供されていません。<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></p><h3 id=イベント駆動api>イベント駆動API
<a class=heading-link href=#%e3%82%a4%e3%83%99%e3%83%b3%e3%83%88%e9%a7%86%e5%8b%95api><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Playwrightは<code>waitForRequest</code>の他にもPage上の<code>load</code>、<code>domcontentloaded</code>、<code>close</code>などのイベントをきっかけにする<code>waitForEvent</code>などのブラウザ側から起動するAPIが実装されています。これはPlaywrightがブラウザと双方向通信をしているため可能になっています。これらのAPIによってPlaywrightはAjax通信の終了や他のJavaScript処理の終了を確実に検知してからテストスクリプトを実行することができます。
WebDriverはこういったAPIがないため、イベントの完了を検知するには画面上の変化（ボタンの状態、メッセージの表示）をポーリングすることになります。</p><h3 id=クラウド環境での実行>クラウド環境での実行
<a class=heading-link href=#%e3%82%af%e3%83%a9%e3%82%a6%e3%83%89%e7%92%b0%e5%a2%83%e3%81%a7%e3%81%ae%e5%ae%9f%e8%a1%8c><i class="fa fa-link" aria-hidden=true></i></a></h3><p>一方でWebDriverは物理的／仮想的に別のマシンにあるブラウザを操作することができます。これはWebDriverが特定のプログラミング言語のライブラリではなく、HTTPプロトコルだから可能になっています。テストスクリプトとブラウザ間の通信がHTTPなので、テストスクリプトとブラウザが同じ環境にある必要がありません。これを利用して<a href=https://saucelabs.com/>Sauce Labs</a>や<a href=https://www.browserstack.com/>BrowserStack</a>のようにクラウド環境にブラウザを用意しSelenium WebDriverで接続するサービスが提供されています。
Playwrightは現在このような機能はありませんが、前述の<code>BrowserContext</code>クラスを基点にクラウドネイティブに使えるようにする計画があるようです。</p><h2 id=まとめ>まとめ
<a class=heading-link href=#%e3%81%be%e3%81%a8%e3%82%81><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Playwrightについて駆け足で追ってきました。まだ見れていない機能がたくさんあるため機会を見て記事を書いていきたいです。
新しいツールが出てくるとこれまでのツールはどうなるんだと考えるのですが、それぞれ影響しあってより洗練されていくのが望ましいですね。</p><hr><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p><a href=https://github.com/microsoft/playwright/blob/v0.10.0/README.md#q-how-does-playwright-relate-to-puppeteer>https://github.com/microsoft/playwright/blob/v0.10.0/README.md#q-how-does-playwright-relate-to-puppeteer</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p><a href=https://github.com/microsoft/playwright/blob/v0.10.0/src/deviceDescriptors.ts>https://github.com/microsoft/playwright/blob/v0.10.0/src/deviceDescriptors.ts</a> <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p><a href=https://github.com/puppeteer/puppeteer/blob/v2.1.0/lib/DeviceDescriptors.js>https://github.com/puppeteer/puppeteer/blob/v2.1.0/lib/DeviceDescriptors.js</a> <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p><a href=https://www.w3.org/TR/webdriver/#cookies>https://www.w3.org/TR/webdriver/#cookies</a> <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p><a href=https://chromedriver.chromium.org/mobile-emulation>https://chromedriver.chromium.org/mobile-emulation</a> <a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div><footer></footer></article></section></div><footer class=footer><section class=container><p>CC BY-SA 4.0</p>©
2018 -
2021
takeya0x86
·
利用技術 <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/dark-mode.min.aee9c8a464eb7b3534c7110f7c5e169e7039e2fd92710e0626d451d6725af137.js integrity="sha256-runIpGTrezU0xxEPfF4WnnA54v2ScQ4GJtRR1nJa8Tc="></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-162084685-1','auto'),ga('send','pageview'))</script></body></html>